<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数学柴の扩展模板介绍</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1, h2, h3 {
            color: #2c3e50;
        }
        
        h1 {
            text-align: center;
            border-bottom: 3px solid #066c39;
            padding-bottom: 20px;
        }
        
        h2 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        
        .language-selector {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .language-selector button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .language-selector button:hover {
            background-color: #2980b9;
        }
        
        .language-selector button.active {
            background-color: #066c39;
        }
        
        .toc {
            background-color: #f1f8ff;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .toc h3 {
            margin-top: 0;
        }
        
        .toc ul {
            padding-left: 20px;
        }
        
        .toc li {
            margin: 8px 0;
        }
        
        .toc a {
            text-decoration: none;
            color: #3498db;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        code {
            background-color: #f4f4f4;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        
        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        
        ul, ol {
            padding-left: 20px;
        }
        
        li {
            margin: 10px 0;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>数学柴の扩展模板介绍</h1>
        
        <div class="language-selector">
            <button class="lang-btn active" data-lang="zh">中文</button>
            <button class="lang-btn" data-lang="en">English</button>
        </div>
        
        <!-- 中文内容 -->
        <div id="content-zh" class="content-section active">
            <div class="toc">
                <h3>目录</h3>
                <ul>
                    <li><a href="#zh-intro">扩展介绍</a></li>
                    <li><a href="#zh-features">功能特性</a></li>
                    <li><a href="#zh-blocks">积木说明</a></li>
                    <li><a href="#zh-usage">使用方法</a></li>
                </ul>
            </div>

            <h2 id="zh-intro">扩展介绍</h2>
            <p>本扩展（Version 1.2.0）实现了“排行榜（Leaderboard）”与“成就（Achievements）”的功能，适用于在 Scratch/拓展环境中记录玩家分数与颁发成就。数据存储于本地 localStorage（键名：<code>turbo_leaderboards_v1</code>），并提供可视化覆盖层用于展示排行榜与成就列表。</p>

            <h2 id="zh-features">功能特性</h2>
            <ul>
                <li>排行榜：创建榜单、提交分数、查询前 N 名、查询名次与最高分、重置榜单、导出全部数据（JSON）。</li>
                <li>成就系统：定义成就（ID/名称/标签）、颁发成就、查询是否已解锁、显示分组成就列表。</li>
                <li>覆盖层 UI：右上角浮动面板，显示排行名次、金/银/铜徽章与成就解锁状态；样式通过动态注入的 &lt;style&gt; 管理。</li>
                <li>显示控制：toggle 类型参数支持 'open'/'close'，也保留原有“切换”行为。</li>
                <li>文档快捷按钮：扩展带有打开文档的按钮（打开扩展文档页面）。</li>
            </ul>

            <h2 id="zh-blocks">积木说明（摘要）</h2>
            <ul>
                <li><strong>创建/管理排行榜</strong>：
                    <ul>
                        <li><code>创建排行榜 [BOARD]</code>：在本地创建一个榜单对象。</li>
                        <li><code>提交分数 名称 [NAME] 分数 [SCORE] 到 [BOARD]</code>：提交并只在更高分或更早时间保留。</li>
                        <li><code>获取前 [N] 名 从 [BOARD]</code>：以 JSON 字符串返回前 N 项（含 rank/name/score）。</li>
                        <li><code>查询 名称 [NAME] 在 [BOARD] 的名次</code>、<code>查询 名称 [NAME] 在 [BOARD] 的最高分</code>、<code>重置排行榜 [BOARD]</code> 等。</li>
                        <li><code>[TOGGLE] 排行榜 [BOARD]</code>：支持 TOGGLE 为 'open' 或 'close'；未指定时为切换显示。</li>
                    </ul>
                </li>
                <li><strong>成就</strong>：
                    <ul>
                        <li><code>创建成就 ID [ID] 名称 [NAME] 标签 [TAG]</code>：按标签分组保存成就元数据。</li>
                        <li><code>颁发成就 ID [ID] 标签 [TAG] 给 用户 [PLAYER] （可选名称 [NAME]）</code>：记录玩家在该标签下已解锁的成就（含时间戳）。</li>
                        <li><code>成就 ID [ID] 在 标签 [TAG] 是否被 用户 [PLAYER] 解锁</code>：返回布尔值。</li>
                        <li><code>[TOGGLE] 成就 标签 [TAG] 用户 [PLAYER]</code>：显示/隐藏对应玩家该标签下的成就列表，支持 'open'/'close'。</li>
                    </ul>
                </li>
                <li><strong>其他</strong>：<code>整个排行榜数据</code> 返回包含 <code>__achievements_meta</code> 与 <code>__achievements_unlocked</code> 的整体 JSON。</li>
            </ul>

            <h2 id="zh-usage">使用方法</h2>
            <ol>
                <li>将扩展加载到 Scratch（或兼容环境）中；扩展 ID 为 <code>leaderboard</code>，会在积木面板显示对应的积木。</li>
                <li>使用“创建排行榜”与“提交分数”收集数据；数据保存在 localStorage（键名如上）。</li>
                <li>通过 <code>[TOGGLE] 排行榜 [BOARD]</code> 或 <code>[TOGGLE] 成就 标签 [TAG] 用户 [PLAYER]</code> 控制覆盖层显示；传入 'open' / 'close' 可以显式打开或关闭面板。</li>
                <li>在覆盖层可查看前若干名次与成就解锁状态；超过 50 条时会提示“还有 N 条记录”。</li>
                <li>可调用 <code>整个排行榜数据</code> 积木以获取完整 JSON 用于导出或调试。</li>
            </ol>
        </div>
        
        <!-- 英文内容 -->
        <div id="content-en" class="content-section">
            <div class="toc">
                <h3>Table of Contents</h3>
                <ul>
                    <li><a href="#en-intro">Extension Introduction</a></li>
                    <li><a href="#en-features">Features</a></li>
                    <li><a href="#en-blocks">Block Descriptions</a></li>
                    <li><a href="#en-usage">Usage</a></li>
                </ul>
            </div>

            <h2 id="en-intro">Extension Introduction</h2>
            <p>This extension (Version 1.2.0) implements Leaderboards and Achievements for Scratch-like environments. Data is stored locally in <code>localStorage</code> under the key <code>turbo_leaderboards_v1</code>. A floating overlay panel is provided to visualize leaderboards and grouped achievements.</p>

            <h2 id="en-features">Features</h2>
            <ul>
                <li>Leaderboards: create boards, submit scores, get top N, query rank/highscore, reset board, export full data as JSON.</li>
                <li>Achievements: define achievements (ID/name/tag), award achievements to players, check unlock status, display grouped achievement lists.</li>
                <li>Overlay UI: top-right floating panel with badges (gold/silver/bronze) and unlocked/locked states. Styles are injected dynamically.</li>
                <li>Display control: toggle parameter supports 'open'/'close' and also a toggle behavior if unspecified.</li>
                <li>Doc button: a block opens the extension documentation in a new tab.</li>
            </ul>

            <h2 id="en-blocks">Block Descriptions (summary)</h2>
            <ul>
                <li><strong>Leaderboard blocks</strong>:
                    <ul>
                        <li><code>CreateBoard [BOARD]</code> — create a board object in storage.</li>
                        <li><code>SubmitScore NAME [NAME] SCORE [SCORE] TO [BOARD]</code> — submits a score; better scores or earlier timestamps are kept.</li>
                        <li><code>GetTop [N] From [BOARD]</code> — returns top N as JSON array of {rank,name,score}.</li>
                        <li><code>GetRank NAME [NAME] In [BOARD]</code>, <code>GetHighScore NAME [NAME] In [BOARD]</code>, <code>ResetBoard [BOARD]</code>, and <code>[TOGGLE] Leaderboard [BOARD]</code> (supports 'open'/'close').</li>
                    </ul>
                </li>
                <li><strong>Achievement blocks</strong>:
                    <ul>
                        <li><code>CreateAchievement ID [ID] NAME [NAME] TAG [TAG]</code> — add achievement metadata grouped by tag.</li>
                        <li><code>AwardAchievement ID [ID] TAG [TAG] TO PLAYER [PLAYER] (optional NAME [NAME])</code> — record unlocked achievement with timestamp.</li>
                        <li><code>IsAchievementUnlocked ID [ID] TAG [TAG] PLAYER [PLAYER]</code> — returns boolean.</li>
                        <li><code>[TOGGLE] Achievements TAG [TAG] PLAYER [PLAYER]</code> — show/hide the achievements overlay for a player (supports 'open'/'close').</li>
                    </ul>
                </li>
                <li><strong>Other</strong>: <code>GetAllData</code> returns a JSON object containing <code>__achievements_meta</code> and <code>__achievements_unlocked</code>.</li>
            </ul>

            <h2 id="en-usage">Usage</h2>
            <ol>
                <li>Load the extension into Scratch or a compatible environment; extension id is <code>leaderboard</code>.</li>
                <li>Create boards and submit scores using the provided blocks; data persists in localStorage.</li>
                <li>Control the overlay with the toggle blocks; pass 'open' or 'close' to explicitly open/close the UI.</li>
                <li>Use <code>GetAllData</code> to export the full dataset for debugging or backup.</li>
            </ol>
        </div>
        
        <div class="footer">
            <p>数学柴の扩展模板 - 为Scratch用户提供扩展开发参考</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const langButtons = document.querySelectorAll('.lang-btn');
            const contentSections = document.querySelectorAll('.content-section');
            
            langButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    
                    // 更新按钮状态
                    langButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 显示对应语言内容
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === `content-${lang}`) {
                            section.classList.add('active');
                        }
                    });
                });
            });
            
            // 目录链接滚动功能
            document.querySelectorAll('.toc a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        });
    </script>
</body>
</html>
